# Mobile Auth Test Project

Next.js + iOS + Android í”„ë¡œì íŠ¸ë¡œ ëª¨ë°”ì¼ ì•±ì—ì„œ Transcodes WebAuthn/Passkey ì¸ì¦ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

## ê¸°ìˆ  ìŠ¤íƒ

- **Next.js**: 15.3.4
- **React**: 19.1.0
- **TypeScript**: 5.8.3
- **iOS**: Swift (WKWebView)
- **Android**: Kotlin (WebView)
- **ì¸ì¦**: Transcodes SDK

## ê°œë°œ í™˜ê²½

ì´ í”„ë¡œì íŠ¸ëŠ” ë‹¤ìŒ ê°œë°œ í™˜ê²½ì—ì„œ ì‘ì„± ë° í…ŒìŠ¤íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤:

- **Xcode**: 16.2.0
- **Android Studio**: Ladybug Feature Drop | 2024.2.2 (Build #AI-242.23726.103.2422.12816248)
- **Runtime**: OpenJDK 64-Bit Server VM 21.0.4+ (aarch64)

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
transcode-native-app-auth/
â”œâ”€â”€ nextjs-app/          # Next.js ì›¹ ì•± (WebViewì—ì„œ ë¡œë“œ)
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â””â”€â”€ mobile/  # ì¸ì¦ í˜ì´ì§€
â”‚   â”‚   â”œâ”€â”€ layout.tsx   # SDK ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
â”‚   â”‚   â””â”€â”€ page.tsx      # í™ˆ í˜ì´ì§€
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ ios-app/             # iOS ë„¤ì´í‹°ë¸Œ ì•±
â”‚   â””â”€â”€ MobileAuthTest/
â”‚       â””â”€â”€ MobileAuthTest/
â”‚           â”œâ”€â”€ AuthWebViewController.swift  # WebView ì»¨íŠ¸ë¡¤ëŸ¬
â”‚           â”œâ”€â”€ MainViewController.swift     # ë©”ì¸ í™”ë©´
â”‚           â”œâ”€â”€ KeychainHelper.swift          # Keychain ê´€ë¦¬
â”‚           â”œâ”€â”€ AppDelegate.swift
â”‚           â”œâ”€â”€ SceneDelegate.swift
â”‚           â””â”€â”€ Info.plist                   # ë„¤íŠ¸ì›Œí¬ ì„¤ì • í¬í•¨
â”‚
â””â”€â”€ android-app/         # Android ë„¤ì´í‹°ë¸Œ ì•±
    â””â”€â”€ app/
        â””â”€â”€ src/
            â””â”€â”€ main/
                â”œâ”€â”€ java/com/transcodes/mobileauthtest/
                â”‚   â”œâ”€â”€ MainActivity.kt           # ë©”ì¸ í™”ë©´
                â”‚   â”œâ”€â”€ AuthWebViewActivity.kt    # WebView ì»¨íŠ¸ë¡¤ëŸ¬
                â”‚   â””â”€â”€ TokenHelper.kt            # EncryptedSharedPreferences ê´€ë¦¬
                â”œâ”€â”€ res/
                â”‚   â”œâ”€â”€ layout/
                â”‚   â”‚   â””â”€â”€ activity_main.xml
                â”‚   â””â”€â”€ values/
                â”‚       â””â”€â”€ strings.xml
                â””â”€â”€ AndroidManifest.xml           # ë„¤íŠ¸ì›Œí¬ ì„¤ì • í¬í•¨
```

## ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         iOS Native App                  â”‚  â”‚      Android Native App                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  MainViewController               â”‚  â”‚  â”‚  â”‚  MainActivity                      â”‚  â”‚
â”‚  â”‚  - Login/Logout Button           â”‚  â”‚  â”‚  â”‚  - Login/Logout Button           â”‚  â”‚
â”‚  â”‚  - Status Display                 â”‚  â”‚  â”‚  â”‚  - Status Display               â”‚  â”‚
â”‚  â”‚  - Token Display                  â”‚  â”‚  â”‚  â”‚  - Token Display                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                 â”‚                        â”‚  â”‚                 â”‚                        â”‚
â”‚                 â–¼                        â”‚  â”‚                 â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AuthWebViewController            â”‚  â”‚  â”‚  â”‚  AuthWebViewActivity            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â”‚  WKWebView                  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  WebView                    â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â”‚  â”‚  Next.js Auth Page    â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  Next.js Auth Page    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  /auth/mobile         â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  /auth/mobile         â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚  JS Bridge (WKScriptMessageHandler)â”‚ â”‚  â”‚  â”‚  JS Bridge (@JavascriptInterface)â”‚
â”‚  â”‚  Console Logger                    â”‚  â”‚  â”‚  â”‚  Console Logger                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                 â”‚                        â”‚  â”‚                 â”‚                        â”‚
â”‚                 â–¼                        â”‚  â”‚                 â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  KeychainHelper                   â”‚  â”‚  â”‚  â”‚  TokenHelper                    â”‚  â”‚
â”‚  â”‚  - Save Token                     â”‚  â”‚  â”‚  â”‚  - Save Token                   â”‚  â”‚
â”‚  â”‚  - Get Token                      â”‚  â”‚  â”‚  â”‚  - Get Token                    â”‚  â”‚
â”‚  â”‚  - Delete Token                   â”‚  â”‚  â”‚  â”‚  - Delete Token                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Next.js Server (localhost:3001)     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  app/layout.tsx                   â”‚  â”‚
â”‚  â”‚  - SDK Script Injection           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  app/auth/mobile/page.tsx        â”‚  â”‚
â”‚  â”‚  - Auth Flow                      â”‚  â”‚
â”‚  â”‚  - Token Retrieval                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ì„¤ì • ë°©ë²•

### 1. Next.js ì•± ì„¤ì •

```bash
cd nextjs-app
npm install
```

`.env.local` íŒŒì¼ ìƒì„±:

```bash
touch .env.local
```

`.env.local` íŒŒì¼ì„ ì—´ì–´ì„œ Transcodes Project IDì™€ API Base URLì„ ì„¤ì •:

```env
NEXT_PUBLIC_TRANSCODES_PROJECT_ID=proj_your_project_id_here
```

ê°œë°œ ì„œë²„ ì‹¤í–‰:

```bash
npm run dev
```

ì„œë²„ê°€ `http://localhost:3001`ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.

**ì°¸ê³ **: SDKëŠ” `app/layout.tsx`ì—ì„œ ìë™ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤. Project IDê°€ ì„¤ì •ë˜ë©´ `https://d2xt92e3v27lcm.cloudfront.net/{projectId}/webworker.js` ìŠ¤í¬ë¦½íŠ¸ê°€ í˜ì´ì§€ì— ì£¼ì…ë©ë‹ˆë‹¤.

### 2. iOS ì•± ì„¤ì •

1. Xcodeì—ì„œ `ios-app/MobileAuthTest.xcodeproj` ì—´ê¸°
2. **Signing & Capabilities** íƒ­ì—ì„œ:
   - Team ì„ íƒ (ê°œì¸ ê°œë°œì ê³„ì • ë˜ëŠ” íŒ€)
   - Bundle Identifier í™•ì¸: `com.transcodes.mobileauthtest`
3. `Info.plist` íŒŒì¼ì—ì„œ `API_URL` ì„¤ì •:
   - Xcodeì—ì„œ `ios-app/MobileAuthTest/Info.plist` íŒŒì¼ ì—´ê¸°
   - `API_URL` í‚¤ ì¶”ê°€ (ë˜ëŠ” ê¸°ì¡´ ê°’ ìˆ˜ì •)
   ```xml
   <key>API_URL</key>
   <string>https://transcode-native-app-auth.vercel.app</string>
   ```
   
   **ì°¸ê³ **: `AuthWebViewController.swift`ëŠ” `Info.plist`ì˜ `API_URL`ì„ ì‚¬ìš©í•˜ì—¬ í™˜ê²½ë³€ìˆ˜ì—ì„œ URLì„ ê°€ì ¸ì˜µë‹ˆë‹¤. í•˜ë“œì½”ë”©ëœ URLì´ ì—†ìœ¼ë©°, `Info.plist`ì—ì„œë§Œ ê´€ë¦¬ë©ë‹ˆë‹¤.

### 3. Android ì•± ì„¤ì •

1. Android Studioì—ì„œ `android-app` í´ë”ë¥¼ í”„ë¡œì íŠ¸ë¡œ ì—´ê¸°
2. **Android SDK ê²½ë¡œ ì„¤ì •** (ì²˜ìŒ ì—´ ë•Œ ë‹¤ì´ì–¼ë¡œê·¸ê°€ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìŒ):
   - macOS ê¸°ë³¸ ê²½ë¡œ: `~/Library/Android/sdk` ë˜ëŠ” `/Users/[ì‚¬ìš©ìëª…]/Library/Android/sdk`
   - ë‹¤ì´ì–¼ë¡œê·¸ì—ì„œ "Select Android SDK:" í•„ë“œì— ê²½ë¡œ ì…ë ¥
   - í´ë” ì•„ì´ì½˜ì„ í´ë¦­í•˜ì—¬ íŒŒì¼ ë¸Œë¼ìš°ì €ë¡œ ì„ íƒ ê°€ëŠ¥
3. **Gradle Sync** ì‹¤í–‰ (í”„ë¡œì íŠ¸ê°€ ì—´ë¦¬ë©´ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ê±°ë‚˜ ìƒë‹¨ì˜ "Sync Now" í´ë¦­)
4. `android-app/gradle.properties` íŒŒì¼ì—ì„œ `API_URL` ì„¤ì •:
   ```properties
   # API Base URL
   API_URL=https://transcode-native-app-auth.vercel.app
   ```
   
   **ì°¸ê³ **: `AuthWebViewActivity.kt`ëŠ” `BuildConfig.API_URL`ì„ ì‚¬ìš©í•˜ì—¬ í™˜ê²½ë³€ìˆ˜ì—ì„œ URLì„ ê°€ì ¸ì˜µë‹ˆë‹¤. í•˜ë“œì½”ë”©ëœ URLì´ ì—†ìœ¼ë©°, `gradle.properties`ì—ì„œë§Œ ê´€ë¦¬ë©ë‹ˆë‹¤.

### 4. ë„¤íŠ¸ì›Œí¬ ì„¤ì •

#### iOS

1. **Info.plist**ì— ì´ë¯¸ `NSAppTransportSecurity` ì„¤ì •ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
2. **í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬**: `Info.plist`ì˜ `API_URL`ì„ ë³€ê²½í•œ í›„ ì•±ì„ ë‹¤ì‹œ ë¹Œë“œí•´ì•¼ ë³€ê²½ì‚¬í•­ì´ ì ìš©ë©ë‹ˆë‹¤.

#### Android

1. **AndroidManifest.xml**ì— `android:usesCleartextTraffic="true"` ì„¤ì •ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
2. **í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬**: `gradle.properties`ì˜ `API_URL`ì„ ë³€ê²½í•œ í›„ **Gradle Sync**ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•´ì•¼ ë³€ê²½ì‚¬í•­ì´ ì ìš©ë©ë‹ˆë‹¤.

## ì£¼ìš” ê¸°ëŠ¥ ìƒì„¸

### ì¸ì¦ í”Œë¡œìš° (`/auth/mobile`)

1. SDK ìë™ ë¡œë“œ ë° ì´ˆê¸°í™”
2. `openAuthLoginModal()` ìë™ í˜¸ì¶œ
3. Passkey ì¸ì¦ ì§„í–‰
4. í† í° íšë“ (`getAccessToken()` API ì‚¬ìš©)
5. Native ì•±ìœ¼ë¡œ í† í° ì „ë‹¬
6. Keychainì— í† í° ì €ì¥

## ì‚¬ìš© ë°©ë²•

### 1. Next.js ì„œë²„ ì‹¤í–‰

```bash
cd nextjs-app
npm run dev
```

### 2. iOS ì•± ì‹¤í–‰

1. Xcodeì—ì„œ í”„ë¡œì íŠ¸ ì—´ê¸°
2. ì‹œë®¬ë ˆì´í„° ë˜ëŠ” ì‹¤ì œ ê¸°ê¸° ì„ íƒ
3. Run ë²„íŠ¼ í´ë¦­ (âŒ˜R)

### 3. Android ì•± ì‹¤í–‰

1. Android Studioì—ì„œ í”„ë¡œì íŠ¸ ì—´ê¸°
2. ì—ë®¬ë ˆì´í„° ë˜ëŠ” ì‹¤ì œ ê¸°ê¸° ì„ íƒ
3. Run ë²„íŠ¼ í´ë¦­ (â–¶ï¸)

### 4. í…ŒìŠ¤íŠ¸ í”Œë¡œìš°

1. ì•± ì‹¤í–‰ í›„ "Login with Passkey" ë²„íŠ¼ í´ë¦­
2. WebViewê°€ ì—´ë¦¬ê³  Next.js ì¸ì¦ í˜ì´ì§€ (`/auth/mobile`) ë¡œë“œ
3. SDKê°€ ìë™ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ê³  ë¡œê·¸ì¸ ëª¨ë‹¬ í‘œì‹œ
4. Passkey ì¸ì¦ ì™„ë£Œ
5. í† í°ì´ Keychainì— ì €ì¥ë˜ê³  ë©”ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°
6. ìƒíƒœê°€ "âœ… Authenticated"ë¡œ ë³€ê²½ë˜ê³  í† í°ì´ í‘œì‹œë¨
7. ë¡œê·¸ì•„ì›ƒí•˜ë ¤ë©´ "Logout" ë²„íŠ¼ í´ë¦­ (í† í°ì´ Keychainì—ì„œ ì‚­ì œë¨)

## JS Bridge í†µì‹  í”„ë¡œí† ì½œ

### WebView â†’ Native (iOS/Android)

```typescript
// ì¸ì¦ ì‹œì‘
sendToNative('AUTH_STARTED', {});

// ì¸ì¦ ì„±ê³µ
sendToNative('AUTH_SUCCESS', {
  token: string,
  user: {
    id: string,
    email?: string,
    name?: string
  }
});

// ì¸ì¦ ì·¨ì†Œ
sendToNative('AUTH_CANCELLED', {
  error?: string
});

// ì¸ì¦ ì‹¤íŒ¨
sendToNative('AUTH_ERROR', {
  message: string
});
```

### Bridge êµ¬í˜„

- **iOS**: `window.webkit.messageHandlers.nativeBridge.postMessage()`
- **Android**: `window.AndroidBridge.postMessage()`

### Console Logging

**iOS**: WKWebViewì—ì„œ JavaScript ì½˜ì†” ë¡œê·¸ë¥¼ ìë™ìœ¼ë¡œ ìº¡ì²˜í•˜ì—¬ Xcode ì½˜ì†”ì— ì¶œë ¥í•©ë‹ˆë‹¤.

**Android**: WebViewì˜ `onConsoleMessage`ë¥¼ í†µí•´ JavaScript ì½˜ì†” ë¡œê·¸ë¥¼ Logcatì— ì¶œë ¥í•©ë‹ˆë‹¤.

ë¡œê·¸ ë ˆë²¨ ë§¤í•‘:
- `console.log` â†’ `ğŸ“ [JS Console]`
- `console.error` â†’ `âŒ [JS Console]`
- `console.warn` â†’ `âš ï¸ [JS Console]`
- `console.info` â†’ `â„¹ï¸ [JS Console]`
- `console.debug` â†’ `ğŸ” [JS Console]`

## ë””ë²„ê¹…

### Next.js ì½˜ì†”

ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ì—ì„œ í™•ì¸:
- SDK ë¡œë“œ ìƒíƒœ (`window.transcodes` í™•ì¸)
- ì¸ì¦ í”Œë¡œìš° (`[Page]` ì ‘ë‘ì‚¬ ë¡œê·¸)
- ì—ëŸ¬ ë©”ì‹œì§€

### iOS ì½˜ì†”

Xcode ì½˜ì†”ì—ì„œ í™•ì¸:
- `[iOS]` ì ‘ë‘ì‚¬ê°€ ë¶™ì€ ë„¤ì´í‹°ë¸Œ ë¡œê·¸
- `ğŸ“ [JS Console]` ì ‘ë‘ì‚¬ê°€ ë¶™ì€ JavaScript ì½˜ì†” ë¡œê·¸
- í† í° ì €ì¥/ì¡°íšŒ ìƒíƒœ
- WebView ë„¤ë¹„ê²Œì´ì…˜ ì—ëŸ¬

### Android ì½˜ì†”

Android Studio Logcatì—ì„œ í™•ì¸:
- `[Android]` ì ‘ë‘ì‚¬ê°€ ë¶™ì€ ë„¤ì´í‹°ë¸Œ ë¡œê·¸
- `ğŸ“ [JS Console]` ì ‘ë‘ì‚¬ê°€ ë¶™ì€ JavaScript ì½˜ì†” ë¡œê·¸
- í† í° ì €ì¥/ì¡°íšŒ ìƒíƒœ
- WebView ë„¤ë¹„ê²Œì´ì…˜ ì—ëŸ¬

### WebView ë””ë²„ê¹…

**iOS ì‹œë®¬ë ˆì´í„°**:
1. Safari â†’ Develop â†’ Simulator â†’ [Your App]
2. WebView ì½˜ì†” í™•ì¸ ê°€ëŠ¥
3. JavaScript ë””ë²„ê±° ì‚¬ìš© ê°€ëŠ¥

**Android ì—ë®¬ë ˆì´í„°/ê¸°ê¸°**:
1. Chromeì—ì„œ `chrome://inspect` ì ‘ì†
2. ë””ë°”ì´ìŠ¤ ëª©ë¡ì—ì„œ WebView ì„ íƒ
3. JavaScript ë””ë²„ê±° ì‚¬ìš© ê°€ëŠ¥

### SDK ì´ˆê¸°í™” í™•ì¸

ì¸ì¦ í˜ì´ì§€ì—ì„œ SDK ì´ˆê¸°í™” ìƒíƒœë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
- SDK ë¡œë“œ ìƒíƒœ
- Project ID í™•ì¸
- Script URL í™•ì¸

## ë¬¸ì œ í•´ê²°

### 1. "Native bridge not found" ì—ëŸ¬

- WebViewê°€ ì œëŒ€ë¡œ ë¡œë“œë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤
- `AuthWebViewController.swift`ì˜ `setupWebView()` í™•ì¸
- JS Bridge ì´ë¦„ì´ `nativeBridge`ì¸ì§€ í™•ì¸

### 2. iOS ë¹Œë“œ ì—ëŸ¬

- `Info.plist`ì˜ `API_URL`ì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
- `API_URL` ë³€ê²½ í›„ ì•±ì„ ë‹¤ì‹œ ë¹Œë“œí•´ì•¼ ë³€ê²½ì‚¬í•­ì´ ì ìš©ë©ë‹ˆë‹¤
- `Info.plist`ì˜ `NSAppTransportSecurity` ì„¤ì • í™•ì¸

### 3. SDK ë¡œë“œ ì‹¤íŒ¨

- `.env.local`ì˜ Project ID í™•ì¸
- ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸
- Transcodes Dashboardì—ì„œ Project ID í™•ì¸

### 4. í† í° ì €ì¥ ì‹¤íŒ¨

**iOS (Keychain)**:
- iOS ì‹œë®¬ë ˆì´í„° ì¬ì‹œì‘
- Keychain ì ‘ê·¼ ê¶Œí•œ í™•ì¸
- `KeychainHelper.swift`ì˜ ì—ëŸ¬ ë¡œê·¸ í™•ì¸
- Xcode ì½˜ì†”ì—ì„œ `[iOS] âœ… Verified: Token retrieved from Keychain` ë©”ì‹œì§€ í™•ì¸

**Android (EncryptedSharedPreferences)**:
- Android Studio Logcatì—ì„œ `[Android]` ë¡œê·¸ í™•ì¸
- `TokenHelper.kt`ì˜ ì—ëŸ¬ ë¡œê·¸ í™•ì¸
- ì•± ì¬ì„¤ì¹˜ (SharedPreferences ì´ˆê¸°í™”)

### 5. SDK ì´ˆê¸°í™” ì‹¤íŒ¨

- `.env.local`ì˜ Project ID í™•ì¸
- ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ `window.transcodes` ê°ì²´ í™•ì¸
- `layout.tsx`ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ URLì´ ì˜¬ë°”ë¥´ê²Œ ìƒì„±ë˜ëŠ”ì§€ í™•ì¸
- ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸ (CloudFront CDN ì ‘ê·¼ ê°€ëŠ¥ ì—¬ë¶€)

### 6. í† í°ì´ ë¹„ì–´ìˆìŒ

- ì¸ì¦ ì„±ê³µ í›„ `getAccessToken()` APIê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°
- Private keyê°€ ì¤€ë¹„ë˜ì—ˆëŠ”ì§€ í™•ì¸ (`hasPrivateKey()`)
- iOS: Xcode ì½˜ì†”ì—ì„œ í† í° ê¸¸ì´ í™•ì¸
- Android: Logcatì—ì„œ í† í° ê¸¸ì´ í™•ì¸

### 7. Android ë¹Œë“œ ì—ëŸ¬

- `gradle.properties`ì˜ `API_URL`ì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
- `API_URL` ë³€ê²½ í›„ **Gradle Sync**ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤
- `BuildConfig.API_URL`ì´ ì˜¬ë°”ë¥´ê²Œ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸ (ë¹Œë“œ í›„ í™•ì¸ ê°€ëŠ¥)

### 8. iOS ë¹Œë“œ ì—ëŸ¬

- `Info.plist`ì˜ `API_URL`ì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
- `API_URL` ë³€ê²½ í›„ ì•±ì„ ë‹¤ì‹œ ë¹Œë“œí•´ì•¼ ë³€ê²½ì‚¬í•­ì´ ì ìš©ë©ë‹ˆë‹¤
- Xcodeì—ì„œ `Info.plist` íŒŒì¼ì´ ì˜¬ë°”ë¥´ê²Œ ì¸ì‹ë˜ëŠ”ì§€ í™•ì¸

## ì£¼ìš” ê¸°ëŠ¥

### âœ… êµ¬í˜„ ì™„ë£Œ

1. **ì¸ì¦ í”Œë¡œìš°**: Passkey ê¸°ë°˜ ì¸ì¦ ì™„ì „ êµ¬í˜„ (iOS + Android)
2. **í† í° ê´€ë¦¬**: 
   - iOS: Keychainì„ í†µí•œ ì•ˆì „í•œ í† í° ì €ì¥
   - Android: EncryptedSharedPreferencesë¥¼ í†µí•œ ì•ˆì „í•œ í† í° ì €ì¥
3. **Console Logging**: JavaScript ì½˜ì†” ë¡œê·¸ë¥¼ ë„¤ì´í‹°ë¸Œ ì½˜ì†”ë¡œ ì „ë‹¬ (iOS + Android)
5. **Logout**: í† í° ì‚­ì œ ë° ì¸ì¦ ìƒíƒœ ì´ˆê¸°í™”
6. **ì—ëŸ¬ í•¸ë“¤ë§**: ìƒì„¸í•œ ì—ëŸ¬ ë©”ì‹œì§€ ë° ìƒíƒœ í‘œì‹œ
7. **Android êµ¬í˜„**: Android WebView ë²„ì „ ì™„ì „ êµ¬í˜„

### ğŸ”„ ë‹¤ìŒ ë‹¨ê³„

1. **í† í° ê²€ì¦**: ë°±ì—”ë“œ APIì™€ í†µí•©í•˜ì—¬ í† í° ê²€ì¦
2. **ìë™ í† í° ê°±ì‹ **: í† í° ë§Œë£Œ ì „ ìë™ ê°±ì‹  ë¡œì§
3. **ì—ëŸ¬ ì¬ì‹œë„**: ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ì‹œ ìë™ ì¬ì‹œë„ ë¡œì§
4. **Biometric ì¸ì¦**: Face ID / Touch ID / Fingerprint í†µí•©

## ì°¸ê³  ìë£Œ

- [Transcodes Documentation](https://transcodes.dev/docs)
- [WKWebView Guide](https://developer.apple.com/documentation/webkit/wkwebview)
- [Keychain Services](https://developer.apple.com/documentation/security/keychain_services)
- [Android WebView Guide](https://developer.android.com/reference/android/webkit/WebView)
- [EncryptedSharedPreferences](https://developer.android.com/topic/security/data)

